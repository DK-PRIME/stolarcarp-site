<!doctype html>
<html lang="uk" data-rating-ready="0">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Рейтинг сезону — STOLAR CARP</title>

  <link rel="stylesheet" href="assets/css/main.css" />

  <!-- Firebase (compat) -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

  <!-- App -->
  <script defer src="assets/js/firebase-init.js"></script>
  <script defer src="assets/js/config.js"></script>
  <script defer src="assets/js/rating_page.js"></script>

  <style>
    :root{
      --line:rgba(255,255,255,.08);
      --accent-gold:#fbbf24;
      --accent-gold-soft:#facc15;
      --accent-green:#22c55e;
      --accent-red:#ef4444;
      --accent-blue:#38bdf8;
      --panel:#0b0d14;
      --panel2:#05060a;
    }

    .hint{opacity:.75}

    /* =========================
       ✅ NO-FLICKER (ідеально)
       - Поки rating не готовий: показуємо ЛОАДЕР, а таблиці повністю ховаємо.
       - Після data-rating-ready="1": таблиці з’являються одразу правильно.
       ========================= */
    html[data-rating-ready="0"] .season-tables { display:none !important; }
    html[data-rating-ready="1"] .rating-loader { display:none !important; }

    .rating-loader{
      margin-top:14px;
      padding:14px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(90deg, rgba(250,204,21,.08), rgba(17,24,39,.25));
      color:#e5e7eb;
      box-shadow:0 14px 30px rgba(0,0,0,.55);
    }
    .rating-loader__row{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .rating-loader__dot{
      width:10px;height:10px;border-radius:999px;
      background:var(--accent-gold-soft);
      box-shadow:0 0 0 6px rgba(250,204,21,.08);
      animation:pulse 1.1s infinite ease-in-out;
    }
    @keyframes pulse{
      0%,100%{ transform:scale(1); opacity:.85 }
      50%{ transform:scale(1.25); opacity:1 }
    }
    .rating-loader__title{ font-weight:800; letter-spacing:.02em; }
    .rating-loader__sub{ opacity:.8; margin-top:6px; line-height:1.45; }

    /* =========================
       HERO
       ========================= */
    .season-rating-head{
      margin-bottom:24px;
      padding:24px 22px;
      background:
        radial-gradient(circle at top left,rgba(250,204,21,.18) 0,transparent 38%),
        radial-gradient(circle at bottom right,#111827 0,#050609 55%);
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 18px 40px rgba(0,0,0,.7);
    }
    .season-rating-head .kicker{
      letter-spacing:.18em;
      text-transform:uppercase;
      opacity:.8;
      font-size:.78rem;
      margin-bottom:4px;
    }
    .season-rating-head .page-title{ margin:0; }
    .rating-desc{
      max-width:900px;
      margin-top:10px;
      font-size:1rem;
      line-height:1.7;
      opacity:.9;
    }

    /* details */
    .rating-desc-wrap details{
      margin-top:10px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      border-radius:14px;
      padding:10px 12px;
    }
    .rating-desc-wrap summary{
      cursor:pointer;
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      list-style:none;
      opacity:.95;
    }
    .rating-desc-wrap summary::-webkit-details-marker{display:none;}
    .rating-desc-wrap .details-body{ margin-top:10px; }

    @media (max-width:640px){
      .season-rating-head{ padding:18px 16px; }
    }

    /* =========================
       TABLES
       ========================= */
    .card--season{
      margin-top:20px;
      padding:0;
      background:transparent;
      border:none;
      box-shadow:none;
    }
    .card--season h3{ margin:0 0 10px; }

    .season-table-wrapper{
      margin-top:6px;
      border-radius:14px;
      overflow:hidden;
      background:radial-gradient(circle at top,var(--panel) 0,var(--panel2) 55%);
      border:1px solid rgba(255,255,255,.09);
      box-shadow:0 14px 30px rgba(0,0,0,.75);

      width:108%;
      margin-left:-4%;
    }

    .table--season{
      width:100%;
      table-layout:fixed;
      border-collapse:collapse;
      font-size:.7rem;
      background:var(--panel2);
    }
    .table--season thead{
      background:linear-gradient(90deg,#181920,#111827);
    }
    .table--season thead th{
      border-bottom:1px solid var(--line);
      border-right:1px solid rgba(255,255,255,.04);
      padding:4px 2px;
      text-align:center;
      font-weight:600;
      opacity:.95;
      white-space:normal;
      overflow:hidden;
      text-overflow:clip;
      font-size:.6rem;
      line-height:1.25;
      text-transform:uppercase;
      letter-spacing:.04em;
      color:#e5e7eb;
    }
    .table--season thead th:first-child{ text-align:left; }

    .table--season tbody tr{
      background:var(--panel);
      transition:background .15s ease;
      height:40px;
    }
    .table--season tbody tr:nth-child(odd){ background:#10121b; }
    .table--season tbody tr:hover{ background:#191b27; }
    .table--season tbody td{
      padding:3px 2px;
      border-bottom:1px solid rgba(255,255,255,.04);
      border-right:1px solid rgba(255,255,255,.02);
      text-align:center;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      box-sizing:border-box;
      font-size:.7rem;
      color:#e5e7eb;
    }
    .table--season tbody td.col-team{ text-align:left; }

    /* widths */
    .col-place  { width:8%; }
    .col-move   { width:6%; }
    .col-team   { width:19%; }
    .col-stage  { width:8%; }
    .col-points { width:7%; }
    .col-final  { width:8%; }
    .col-weight { width:8%; }
    .col-big    { width:7%; }

    .col-place .place-num{
      display:block;
      font-size:.9rem;
      line-height:1;
      font-weight:700;
      padding-left:5px;
    }

    .move{
      font-size:.6rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:4px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      opacity:.9;
      background:rgba(15,23,42,.7);
    }
    .move--up{color:var(--accent-green);border-color:rgba(34,197,94,.55)}
    .move--down{color:var(--accent-red);border-color:rgba(239,68,68,.55)}
    .move--same{color:#e5e7eb;border-style:dashed}

    .stage-cell{
      display:flex;
      flex-direction:row;
      align-items:center;
      justify-content:center;
      gap:2px;
      font-size:.68rem;
      line-height:1;
    }
    .stage-place{ font-weight:600; color:#e5e7eb; }
    .stage-slash{ opacity:.7; }
    .stage-points{ font-size:.64rem; opacity:.85; color:#9ca3af; }

    .table--main tbody tr.row-qualified td.col-place{
      box-shadow:inset 3px 0 0 var(--accent-gold-soft);
    }
    .table--main tbody tr.row-qualified .place-num{
      color:var(--accent-gold-soft);
    }

    .col-points b{ color:var(--accent-gold); letter-spacing:.02em; }
    .col-big{ color:var(--accent-blue); font-weight:500; }

    .rating-note{
      margin-top:8px;
      font-size:.8rem;
      opacity:.75;
    }

    .subhead{
      margin:18px 0 6px;
      font-weight:600;
      font-size:.95rem;
    }
    .subhead span{
      opacity:.7;
      font-size:.8rem;
      font-weight:400;
    }

    .rating-error{
      margin-top:14px;
      padding:14px 14px;
      border-radius:14px;
      border:1px solid rgba(239,68,68,.35);
      background:rgba(239,68,68,.10);
      color:#ffb4b4;
      display:none;
    }
    .rating-error b{ color:#ffd1d1; }

    @media (max-width:480px){
      .table--season{ font-size:.55rem; }
      .table--season thead th,
      .table--season tbody td{ padding:3px 1px; }
      .table--season thead th{ font-size:.55rem; }
      .col-place .place-num{font-size:.78rem;}
      .stage-cell{font-size:.64rem;}
      .stage-points{font-size:.6rem;}
    }
  </style>
</head>

<body>
<header class="header">
  <div class="container header__row">
    <a class="logo" href="index.html" aria-label="STOLAR CARP">
      <span class="logo__mark">SC</span>
      <span class="logo__text">STOLAR CARP</span>
    </a>

    <nav class="nav" id="nav">
      <a href="/index.html" class="nav__link">Головна</a>
      <a href="/rules.html" class="nav__link">Регламент</a>
      <a href="/formats.html" class="nav__link">Формат змагань</a>
      <a href="/register.html" class="nav__link">Реєстрація</a>
      <a href="/live.html" class="nav__link">Live</a>
      <a href="/rating.html" class="nav__link nav__link--active">Рейтинг</a>
      <a href="/lakes.html" class="nav__link">Водойми</a>
      <a href="/sponsors.html" class="nav__link">Спонсори</a>
      <a href="/events/index.html" class="nav__link">Архів</a>
      <a href="/cabinet.html" class="nav__link">Мій кабінет</a>
    </nav>

    <button class="burger" id="burger" aria-label="Відкрити меню">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>

<main class="main">
  <section class="container section">

    <div class="season-rating-head">
      <div class="kicker title-gradient" id="seasonKicker">СЕЗОН</div>
      <h1 class="page-title title-gradient" id="seasonTitle">Рейтинг сезону STOLAR CARP</h1>

      <div class="rating-desc-wrap">
        <p class="lead rating-desc" style="margin-bottom:8px;">
          Рейтинг сезону STOLAR CARP — це офіційна підсумкова таблиця результатів команд за всі етапи сезону.
        </p>

        <details>
          <summary>Детальніше</summary>
          <div class="details-body">
            <p class="lead rating-desc" style="margin:0;">
              Розташування в рейтингу визначається за сумою балів (менше — краще), а при рівності балів вирішальними є
              загальна вага вилову та Big Fish сезону. У таблиці відображаються місце та бали команди за кожен етап.
              <b>18 найкращих команд сезону</b> отримують право участі у <b>Фіналі сезону STOLAR CARP</b>.
              Саме там кращі з кращих розігрують головний титул року.
            </p>
          </div>
        </details>
      </div>

      <div class="rating-error" id="ratingError"></div>

      <!-- ✅ Loader замість "порожньої" таблиці -->
      <div class="rating-loader" role="status" aria-live="polite">
        <div class="rating-loader__row">
          <span class="rating-loader__dot" aria-hidden="true"></span>
          <div class="rating-loader__title">Завантаження рейтингу сезону…</div>
        </div>
        <div class="rating-loader__sub">
          Підтягуємо етапи та список команд. Таблиця зʼявиться одразу в правильному вигляді.
        </div>
      </div>
    </div>

    <!-- ✅ Таблиці (показуються тільки коли data-rating-ready="1") -->
    <div class="season-tables">
      <div class="card card--season">
        <h3>Рейтинг команд сезону</h3>

        <div class="season-table-wrapper">
          <table class="table table--season table--main">
            <thead>
              <tr>
                <th class="col-place">Місце</th>
                <th class="col-move">▲▼</th>
                <th class="col-team">Команда</th>

                <th class="col-stage">Е1<br>м / б</th>
                <th class="col-stage">Е2<br>м / б</th>
                <th class="col-stage">Е3<br>м / б</th>
                <th class="col-stage">Е4<br>м / б</th>
                <th class="col-stage">Е5<br>м / б</th>

                <th class="col-points">Бали</th>
                <th class="col-final">Фінал</th>
                <th class="col-weight">Вага</th>
                <th class="col-big">Big Fish</th>
              </tr>
            </thead>
            <tbody id="season-top"></tbody>
          </table>
        </div>

        <h4 class="subhead">
          Претенденти на участь у Фіналі сезону
          <span>— команди, що знаходяться нижче 18-го місця</span>
        </h4>

        <div class="season-table-wrapper">
          <table class="table table--season table--contenders">
            <thead>
              <tr>
                <th class="col-place">Місце</th>
                <th class="col-move">▲▼</th>
                <th class="col-team">Команда</th>

                <th class="col-stage">Е1<br>м / б</th>
                <th class="col-stage">Е2<br>м / б</th>
                <th class="col-stage">Е3<br>м / б</th>
                <th class="col-stage">Е4<br>м / б</th>
                <th class="col-stage">Е5<br>м / б</th>

                <th class="col-points">Бали</th>
                <th class="col-final">Фінал</th>
                <th class="col-weight">Вага</th>
                <th class="col-big">Big Fish</th>
              </tr>
            </thead>
            <tbody id="season-contenders"></tbody>
          </table>
        </div>
      </div>

      <p class="rating-note">
        Підсумкове місце сезону визначається так:<br />
        <b>1)</b> менша сума балів сезону — краще місце;<br />
        <b>2)</b> якщо бали однакові — вище команда з більшою загальною вагою;<br />
        <b>3)</b> якщо вага теж однакова — вище команда з більшим Big Fish.
      </p>
    </div>

  </section>
</main>

<footer class="footer">
  <div class="container footer__row">
    <div>© 2025 STOLAR CARP · Львів</div>
    <div class="footer__links">
      <a href="https://invite.viber.com/?g=8R04gUEhdVSnX6sr_DxGGGqAXTus0Ygh" rel="noopener">Viber</a>
      <a href="https://youtube.com/@dk-stolarcarp?si=H-BUK2msCiKXdcA9" rel="noopener">YouTube</a>
    </div>
  </div>
</footer>

</body>
</html>
