<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>Мій кабінет · STOLAR CARP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <link rel="apple-touch-icon" href="assets/favicon.png" />
  <meta name="theme-color" content="#020617" />

  <link rel="stylesheet" href="assets/css/main.css" />
  <script defer src="assets/js/config.js"></script>

  <style>
    body.cabinet-page{background:#020617;color:#e5e7eb;}
    .cabinet-hero{padding:26px 0 10px;}
    .cabinet-kicker{font-size:.78rem;letter-spacing:.18em;text-transform:uppercase;color:#9ca3af;display:flex;align-items:center;gap:8px;margin-bottom:6px;}
    .cabinet-kicker-dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(135deg,#facc15,#f97316);box-shadow:0 0 10px rgba(250,204,21,.7);}
    .cabinet-title{margin:0 0 6px;font-size:clamp(22px,3.4vw,30px);font-weight:800;letter-spacing:.06em;text-transform:uppercase;}
    .cabinet-title span{background:linear-gradient(90deg,#facc15 0%,#f97316 40%,#dc2626 100%);-webkit-background-clip:text;background-clip:text;color:transparent;}
    .cabinet-subtitle{margin:0;font-size:.95rem;color:#9ca3af;max-width:640px;}
    .cabinet-layout{margin-top:18px;display:grid;grid-template-columns:minmax(0,1fr);gap:18px;}
    .card{background:#020617;border-radius:18px;border:1px solid #1f2937;box-shadow:0 20px 40px rgba(0,0,0,.75);padding:16px 14px;}
    .card--soft{background:radial-gradient(circle at top,#0b1220 0,#020617 65%);}
    .card-title{margin:0 0 8px;font-size:.9rem;letter-spacing:.14em;text-transform:uppercase;color:#9ca3af;}
    .card-subtitle{margin:0 0 10px;font-size:.86rem;color:#9ca3af;}
    .cabinet-small-muted{font-size:.8rem;color:#6b7280;margin-top:4px;}
    .team-header{display:flex;align-items:flex-start;gap:14px;margin-bottom:12px;}
    
    /* === КРУГЛИЙ АВАТАР === */
    .team-avatar-wrap{
      width:82px;
      height:82px;
      border-radius:50%;
      overflow:hidden;
      background:#0f172a;
      display:flex;
      align-items:center;
      justify-content:center;
      border:2px solid #facc15;
      flex-shrink:0;
      cursor:pointer;
      transition:transform .2s,box-shadow .2s;
    }
    .team-avatar-wrap:hover{
      transform:scale(1.05);
      box-shadow:0 0 15px rgba(250,204,21,.4);
    }
    .team-avatar{
      width:100%;
      height:100%;
      object-fit:cover;
      display:none;
    }
    .team-avatar-placeholder{
      font-weight:800;
      font-size:1.4rem;
      color:#facc15;
    }
    /* === КІНЕЦЬ === */
    
    .team-main{flex:1;}
    .team-name{font-size:1.1rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;margin-bottom:4px;}
    .team-tagline{font-size:.85rem;color:#9ca3af;margin-bottom:8px;}
    .team-meta{display:flex;flex-wrap:wrap;gap:6px;font-size:.8rem;}
    .meta-pill{border-radius:999px;padding:4px 8px;background:#020617;border:1px solid #374151;color:#e5e7eb;}
    .meta-pill strong{color:#facc15;font-weight:600;}
    
    /* === CLOUDINARY WIDGET БЛОК === */
    .avatar-section{margin-top:12px;padding-top:12px;border-top:1px solid #1f2937;}
    .avatar-label{font-size:.8rem;color:#9ca3af;margin-bottom:8px;}
    .avatar-small-btn{border-radius:999px;border:1px solid #374151;background:#0f172a;color:#e5e7eb;padding:6px 14px;font-size:.8rem;cursor:pointer;transition:all .2s;}
    .avatar-small-btn:hover{background:#1e293b;border-color:#facc15;}
    #avatarMsg{margin-top:6px;font-size:.8rem;min-height:20px;}
    #avatarMsg.ok{color:#22c55e;}
    #avatarMsg.err{color:#ef4444;}
    /* === КІНЕЦЬ БЛОКУ === */
    
    .members-list{margin-top:10px;border-top:1px solid #1f2937;padding-top:10px;}
    .members-title{font-size:.86rem;text-transform:uppercase;letter-spacing:.16rem;color:#9ca3af;margin-bottom:6px;}
    .stats-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;margin:8px 0 10px;font-size:.85rem;}
    .stat-card{border-radius:12px;padding:9px 10px;background:radial-gradient(circle at top,#0b1120 0,#020617 70%);border:1px solid #1f2937;}
    .stat-label{color:#9ca3af;margin-bottom:4px;font-size:.78rem;}
    .stat-value{font-size:1.05rem;font-weight:700;}
    .stat-unit{font-size:.8rem;color:#9ca3af;margin-left:3px;}
    #cabinetMsg{margin-top:8px;font-size:.82rem;}
    #cabinetMsg.ok{color:#22c55e;}
    #cabinetMsg.err{color:#ef4444;}

    /* === AVATAR POPUP === */
    #avatarPopup{
      display:none;
      position:fixed;
      left:0;
      top:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.85);
      backdrop-filter:blur(4px);
      z-index:9999;
      align-items:center;
      justify-content:center;
      cursor:zoom-out;
    }
    #avatarPopupImg{
      max-width:90%;
      max-height:90%;
      border-radius:18px;
      box-shadow:0 0 40px rgba(0,0,0,.9);
      object-fit:contain;
    }
    /* === КІНЕЦЬ POPUP === */
  </style>
</head>

<body class="cabinet-page">

<header class="header">
  <div class="container header__row">
    <a class="logo" href="index.html"><span class="logo__mark">SC</span><span class="logo__text">STOLAR CARP</span></a>
    <nav class="nav">
      <a href="index.html" class="nav__link">Головна</a>
      <a href="rules.html" class="nav__link">Регламент</a>
      <a href="/formats.html" class="nav__link">Формат змагань</a>
      <a href="register.html" class="nav__link">Реєстрація</a>
      <a href="live.html" class="nav__link">Live</a>
      <a href="rating.html" class="nav__link">Рейтинг</a>
      <a href="lakes.html" class="nav__link">Водойми</a>
      <a href="sponsors.html" class="nav__link">Спонсори</a>
      <a href="events/index.html" class="nav__link">Архів</a>
      <a href="cabinet.html" class="nav__link nav__link--active">Мій кабінет</a>
    </nav>
    <button class="burger" id="burger"><span></span><span></span><span></span></button>
  </div>
</header>

<main class="main">
<section class="container">

<div class="cabinet-hero">
  <div class="cabinet-kicker"><span class="cabinet-kicker-dot"></span>STOLAR CARP · CABINET</div>
  <h1 class="cabinet-title"><span>МІЙ КАБІНЕТ</span></h1>
  <p class="cabinet-subtitle" id="cabinetStatus">Перевірка доступу до кабінету…</p>
</div>

<div class="cabinet-layout" id="cabinetContent" style="display:none;">

<div class="card card--soft">
<h2 class="card-title">Команда та профіль</h2>
<p class="card-subtitle">Ваш акаунт, команда та базові дані.</p>

<div class="team-header">
  <!-- Клікабельний аватар з попапом -->
  <div class="team-avatar-wrap" id="avatarWrapper" title="Натисніть для збільшення">
    <img id="cabinetAvatarImg" class="team-avatar" alt="Аватар">
    <div id="cabinetAvatarPlaceholder" class="team-avatar-placeholder">SC</div>
  </div>

  <div class="team-main">
    <div class="team-name" id="teamNameText">Команда…</div>
    <div class="team-tagline" id="captainText">Капітан…</div>

    <div class="team-meta">
      <div class="meta-pill"><strong>Роль:</strong> <span id="userRoleText">–</span></div>
      <div class="meta-pill"><strong>Телефон:</strong> <span id="userPhoneText">–</span></div>
      <div class="meta-pill" id="joinCodePill" style="display:none;">
        <strong>Код команди:</strong> <span id="joinCodeText"></span>
      </div>
    </div>

    <!-- Cloudinary Widget -->
    <div class="avatar-section">
      <div class="avatar-label">Аватар учасника</div>
      <button type="button" class="avatar-small-btn" id="openCloudinaryWidget">
        Змінити аватар
      </button>
      <div id="avatarMsg" class="cabinet-small-muted"></div>
    </div>

    <div id="cabinetMsg"></div>
  </div>
</div>

<div class="members-list">
  <div class="members-title">Склад команди</div>
  <div id="membersContainer">
    <div class="cabinet-small-muted">Завантаження списку учасників…</div>
  </div>
</div>
</div>

<!-- МОЯ УЧАСТЬ -->
<div class="card">
<h2 class="card-title">Моя участь</h2>
<div id="myCompetitions">
  <div class="cabinet-small-muted">Завантаження участі…</div>
</div>
</div>

<!-- ДОСЯГНЕННЯ -->
<div class="card">
<h2 class="card-title">Досягнення команди</h2>
<p class="card-subtitle">Підсумки виступів у сезоні STOLAR CARP</p>

<div class="stats-grid">
  <div class="stat-card"><div class="stat-label">Загальний улов</div><div class="stat-value"><span id="statTotalWeight">—</span><span class="stat-unit">кг</span></div></div>
  <div class="stat-card"><div class="stat-label">Big Fish</div><div class="stat-value"><span id="statBigFish">—</span><span class="stat-unit">кг</span></div></div>
  <div class="stat-card"><div class="stat-label">Місце</div><div class="stat-value"><span id="statRank">—</span></div></div>
</div>
</div>

</div>
</section>
</main>

<footer class="footer">
<div class="container footer__row">
  <div>© 2025 STOLAR CARP · Львів</div>
</div>
</footer>

<!-- AVATAR POPUP -->
<div id="avatarPopup">
  <img id="avatarPopupImg" src="" alt="Аватар повний розмір">
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

<!-- Cloudinary Upload Widget -->
<script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

<script src="assets/js/firebase-init.js"></script>
<script src="assets/js/cabinet.js"></script>
<script src="assets/js/cabinet_achievements.js"></script>

</body>
</html>
