<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Список команд — Осінній короп STOLAR CARP</title>
  <link rel="stylesheet" href="../assets/css/main.css">
  <script defer src="../assets/js/config.js"></script>
  <style>
    body{background:#0d0d0f;color:#fff}
    .teams-list {
      margin-top:20px;width:100%;border-collapse:collapse;
      background:#111;border-radius:10px;overflow:hidden;
    }
    .teams-list th, .teams-list td {
      padding:12px 15px;text-align:left;border-bottom:1px solid rgba(255,255,255,.08);
    }
    .teams-list th {
      background:#15161a;color:#e0e0e0;
      text-transform:uppercase;letter-spacing:.4px;font-size:.88rem;
      font-weight:600;
    }
    .teams-list td {color:#f1f1f1;font-size:.95rem;}
    .teams-list tr:hover td {background:rgba(255,255,255,.05);}
    .num{width:3.5rem;opacity:.7}
    .food-badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:.9rem;line-height:1;border:1px solid rgba(255,255,255,.15)}
    .food-yes{background:#1d2a18;color:#d7f7d7;border-color:rgba(22,163,74,.35)}
    .food-no{background:#2a1918;color:#f5d0d0;border-color:rgba(239,68,68,.35)}
  </style>
</head>

<body>
<header class="header">
  <div class="container header__row">
    <a class="logo" href="../index.html">
      <span class="logo__mark">SC</span><span class="logo__text">STOLAR CARP</span>
    </a>
    <nav class="nav" id="nav">
      <a href="../index.html" class="nav__link">Головна</a>
      <a href="../rules.html" class="nav__link">Регламент</a>
      <a href="../register.html" class="nav__link">Реєстрація</a>
      <a href="../live.html" class="nav__link">Live</a>
      <a href="../rating.html" class="nav__link">Рейтинг</a>
      <a href="../sponsors.html" class="nav__link">Спонсори</a>
      <a href="../events/korop2025.html" class="nav__link nav__link--active">Турнір 2025</a>
    </nav>
    <button class="burger" id="burger"><span></span><span></span><span></span></button>
  </div>
</header>

<main class="main">
  <section class="container section section--narrow">
    <h1 class="page-title title-gradient">Список команд — Осінній короп 2025</h1>
    <p class="lead">Учасники головного осіннього турніру STOLAR CARP на водоймі Лелехівка.</p>

    <table class="teams-list">
      <thead>
        <tr>
          <th class="num">№</th>
          <th>Назва команди</th>
          <th>Харчування</th>
        </tr>
      </thead>
      <tbody id="teamsTableBody">
        <tr><td colspan="3" style="opacity:.6">Завантаження…</td></tr>
      </tbody>
    </table>
  </section>
</main>

<footer class="footer">
  <div class="container footer__row">
    <div>© 2025 STOLAR CARP · Львів</div>
    <div class="footer__links">
      <a href="https://invite.viber.com/?g=8R04gUEhdVSnX6sr_DxGGGqAXTus0Ygh">Viber</a>
      <a href="https://youtube.com/@dk-stolarcarp?si=H-BUK2msCiKXdcA9">YouTube</a>
    </div>
  </div>
</footer>

<script>
  // === Налаштування аркуша ===
  const SHEET_ID = "1v5owevBkZuiRGioOjujOMXvvH4w7zbt5UWDCE8ND2Vo"; // твій ID таблиці
  const GID      = "0"; // gid аркуша Осіннього коропа
  const GVIZ = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;

  const tbody = document.getElementById('teamsTableBody');
  const norm  = s => (s ?? '').toString().trim();
  const lower = s => norm(s).toLowerCase();

  function parseGViz(text){
    const start = text.indexOf('{');
    const end   = text.lastIndexOf(')');
    return JSON.parse(text.substring(start, end));
  }

  function render(rows){
    tbody.innerHTML = rows.map((r,i)=>{
      const yes = lower(r.food) === 'так';
      const badge = yes
        ? `<span class="food-badge food-yes">Так${r.foodQty ? ` (${r.foodQty})` : ''}</span>`
        : `<span class="food-badge food-no">Ні</span>`;
      return `
        <tr>
          <td class="num">${i+1}</td>
          <td>${r.team}</td>
          <td>${badge}</td>
        </tr>`;
    }).join('');
  }

  async function loadTeams(){
    try{
      const res  = await fetch(GVIZ, {cache:'no-store'});
      const json = parseGViz(await res.text());

      const rows = (json.table.rows||[]).map(r=>({
        time:    r.c?.[0]?.v ?? '',
        team:    r.c?.[1]?.v ?? '',
        food:    r.c?.[5]?.v ?? '',
        foodQty: r.c?.[6]?.v ?? ''
      }))
      .filter(r => norm(r.team));

      const seen = new Set(); const uniq = [];
      for (const r of rows){
        const key = lower(r.team);
        if(!key || seen.has(key)) continue;
        seen.add(key); uniq.push(r);
      }
      uniq.sort((a,b)=>{
        if(a.time && b.time) return new Date(a.time) - new Date(b.time);
        return a.team.localeCompare(b.team,'uk',{sensitivity:'base'});
      });

      render(uniq);
    }catch(e){
      console.error(e);
      tbody.innerHTML = `<tr><td colspan="3" style="opacity:.7">Не вдалося завантажити список</td></tr>`;
    }
  }

  loadTeams();
</script>
</body>
</html>
