<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Список команд — STOLAR CARP</title>
  <link rel="stylesheet" href="assets/css/main.css">
  <script defer src="assets/js/config.js"></script>
  <style>
    :root{
      --bg:#0d0d0f;
      --card:#14151a;
      --row:#16171c;
      --text:#fff;
      --muted:rgba(255,255,255,.65);
      --line:rgba(255,255,255,.06);
    }
    body{background:var(--bg);color:var(--text);}
    .muted{color:var(--muted)}
    .table-wrap{background:var(--card);border-radius:14px;padding:10px;border:1px solid var(--line)}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{
      position:sticky;top:0;z-index:2;
      background:var(--card);
      text-align:left;font-weight:700;padding:10px 12px;border-bottom:1px solid var(--line);
      font-size:.95rem;letter-spacing:.02em
    }
    tbody td{
      background:var(--row);
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      font-size:0.98rem;
      vertical-align:middle;
    }
    tbody tr:first-child td{border-top-left-radius:10px;border-top-right-radius:10px}
    tbody tr:last-child td{border-bottom-left-radius:10px;border-bottom-right-radius:10px;border-bottom:none}
    .num{width:3.5rem;opacity:.7}
    .food-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.9rem;line-height:1;border:1px solid var(--line)}
    .food-yes{background:#1d2a18}
    .food-no{background:#2a1918}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .meta .muted{font-size:.9rem}
    @media (max-width:640px){
      thead th, tbody td{padding:8px 10px}
      .num{width:2.5rem}
    }
  </style>
</head>
<body>
<header class="header">
  <div class="container header__row">
    <a class="logo" href="index.html">
      <span class="logo__mark">SC</span><span class="logo__text">STOLAR CARP</span>
    </a>
    <nav class="nav" id="nav">
      <a href="index.html" class="nav__link">Головна</a>
      <a href="register.html" class="nav__link">Реєстрація</a>
      <a href="entries.html" class="nav__link nav__link--active">Команди</a>
    </nav>
    <button class="burger" id="burger"><span></span><span></span><span></span></button>
  </div>
</header>

<main class="main">
  <section class="container section section--narrow">
    <h1 class="page-title title-gradient">Список зареєстрованих команд</h1>
    <p class="lead muted">Оновлюється автоматично після відправки заявки.</p>

    <div class="table-wrap">
      <table id="teamTable" aria-describedby="state">
        <thead>
          <tr>
            <th class="num">№</th>
            <th>Назва команди</th>
            <th>Капітан</th>
            <th>Харчування</th>
          </tr>
        </thead>
        <tbody id="teamList"></tbody>
      </table>
      <div class="meta">
        <p id="state" class="muted">Завантаження…</p>
        <p id="total" class="muted"></p>
      </div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="container footer__row">
    <div>© 2025 STOLAR CARP · Львів</div>
  </div>
</footer>

<script>
  // ID твоєї таблиці (залишив той самий)
  const SHEET_ID = "1v5owevBkZuiRGioOjujOMXvvH4w7zbt5UWDCE8ND2Vo";
  // gid=0 якщо перший аркуш; зміни, якщо інший
  const GVIZ = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=0`;

  const tbody = document.getElementById('teamList');
  const state = document.getElementById('state');
  const total = document.getElementById('total');

  async function loadTeams() {
    try {
      state.textContent = 'Завантаження…';
      const res = await fetch(GVIZ, { cache: 'no-store' });
      const text = await res.text();
      // gviz повертає JS, вирізаємо JSON
      const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf(')')));
      const rows = (json.table.rows || [])
        .map(r => ({
          time:     r.c[0]?.v ?? '',
          team:     r.c[1]?.v ?? '',
          captain:  r.c[3]?.v ?? '',
          food:     r.c[5]?.v ?? '',   // "Так" або "Ні"
          foodQty:  r.c[6]?.v ?? ''    // кількість
        }))
        .filter(r => r.team && r.captain);

      // верстка рядків
      tbody.innerHTML = rows.map((r, i) => {
        const foodLabel = (r.food === 'Так')
          ? `<span class="food-badge food-yes">Так${r.foodQty ? ` (${r.foodQty})` : ''}</span>`
          : `<span class="food-badge food-no">Ні</span>`;
        return `
          <tr>
            <td class="num">${i + 1}</td>
            <td>${r.team}</td>
            <td>${r.captain}</td>
            <td>${foodLabel}</td>
          </tr>`;
      }).join('');

      state.textContent = rows.length ? 'Оновлено' : 'Дані відсутні';
      total.textContent = `Всього команд: ${rows.length}`;
    } catch (e) {
      state.textContent = 'Помилка завантаження: ' + e.message;
      total.textContent = '';
    }
  }

  loadTeams();
  // автооновлення кожні 30 секунд
  setInterval(loadTeams, 30000);
</script>
</body>
</html>
