<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è ‚Äî STOLAR CARP 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥-—Å–∫—Ä–∏–ø—Ç–∞ (favicon, —Ç–æ—â–æ) -->
  <script src="assets/js/config.js" defer></script>
</head>
<body class="page page-register">

  <!-- –•–µ–¥–µ—Ä / –º–µ–Ω—é -->
  <header class="site-header">
    <div class="container">
      <div class="logo">STOLAR CARP</div>
      <nav class="main-nav">
        <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="rules.html">–†–µ–≥–ª–∞–º–µ–Ω—Ç</a>
        <a href="register.html" class="active">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
        <a href="live.html">Live</a>
        <a href="rating.html">–†–µ–π—Ç–∏–Ω–≥</a>
        <a href="lakes.html">–í–æ–¥–æ–π–º–∏</a>
        <a href="sponsors.html">–°–ø–æ–Ω—Å–æ—Ä–∏</a>
        <a href="events/2026.html">–¢—É—Ä–Ω—ñ—Ä 2026</a>
      </nav>
    </div>
  </header>

  <main class="page-main">
    <section class="section section-register">
      <div class="container">
        <h1>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ–º–∞–Ω–¥–∏ –Ω–∞ –µ—Ç–∞–ø STOLAR CARP 2026</h1>
        <p class="section-subtitle">
          –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É –Ω–∏–∂—á–µ. –ü—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏ –∑–¥—ñ–π—Å–Ω—ñ—Ç—å –æ–ø–ª–∞—Ç—É —Ç–∞ –≤–∫–∞–∂—ñ—Ç—å <b>–Ω–∞–∑–≤—É –∫–æ–º–∞–Ω–¥–∏</b> —É –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ –ø–ª–∞—Ç–µ–∂—É.
        </p>

        <!-- –ö–∞—Ä—Ç–∫–∞ –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è -->
        <div class="card card-payment">
          <p>
            –û–ø–ª–∞—Ç–∞ –±–ª–∞–≥–æ–¥—ñ–π–Ω–æ–≥–æ –≤–Ω–µ—Å–∫—É: <b>1500 ‚Ç¥</b> –Ω–∞ –∫–∞—Ä—Ç–∫—É
          </p>
          <p>
            –ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏:
            <span id="cardNum" class="card-number">4874 0700 5068 8793</span>
          </p>
          <button type="button" id="copyCard" class="btn btn-secondary">
            –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É
          </button>
        </div>

        <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ -->
        <div id="msg" class="form-msg"></div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
        <form id="regForm" class="form form-register" novalidate>
          <!-- honeypot (–∞–Ω—Ç–∏–±–æ—Ç) -->
          <input
            type="text"
            name="hp"
            id="hp"
            autocomplete="off"
            style="position:absolute;left:-9999px;top:-9999px;height:0;width:0;opacity:0;"
          />

          <!-- fingerprint -->
          <input type="hidden" id="fp" name="fp" />

          <!-- –ü–æ–¥—ñ—è / –µ—Ç–∞–ø -->
          <div class="form-group">
            <label class="form-label">–û–±–µ—Ä—ñ—Ç—å –µ—Ç–∞–ø —Ç—É—Ä–Ω—ñ—Ä—É <span class="req">*</span></label>
            <div id="eventOptions" class="event-options">
              <!-- –°—é–¥–∏ –ø—ñ–¥—Ç—è–≥—É—é—Ç—å—Å—è –µ—Ç–∞–ø–∏ –∑ API -->
              <p id="loading-events">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –µ—Ç–∞–ø—ñ–≤...</p>
            </div>
          </div>

          <!-- –ù–∞–∑–≤–∞ –∫–æ–º–∞–Ω–¥–∏ -->
          <div class="form-group">
            <label for="team_name" class="form-label">
              –ù–∞–∑–≤–∞ –∫–æ–º–∞–Ω–¥–∏ <span class="req">*</span>
            </label>
            <input
              type="text"
              id="team_name"
              name="team_name"
              class="form-input"
              required
              minlength="2"
              maxlength="100"
              placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–æ–º–∞–Ω–¥–∏"
            />
          </div>

          <!-- –ö–∞–ø—ñ—Ç–∞–Ω -->
          <div class="form-group">
            <label for="captain" class="form-label">
              –ö–∞–ø—ñ—Ç–∞–Ω –∫–æ–º–∞–Ω–¥–∏ <span class="req">*</span>
            </label>
            <input
              type="text"
              id="captain"
              name="captain"
              class="form-input"
              required
              minlength="2"
              maxlength="100"
              placeholder="–Ü–º'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ –∫–∞–ø—ñ—Ç–∞–Ω–∞"
            />
          </div>

          <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
          <div class="form-group">
            <label for="phone_rest" class="form-label">
              –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É (—Ñ–æ—Ä–º–∞—Ç: +380XXXXXXXXX) <span class="req">*</span>
            </label>
            <div class="phone-wrapper">
              <span class="phone-prefix">+380</span>
              <input
                type="tel"
                id="phone_rest"
                class="form-input"
                inputmode="numeric"
                placeholder="XXXXXXXXX"
                required
              />
            </div>
            <!-- –ø—Ä–∏—Ö–æ–≤–∞–Ω–µ –ø–æ–ª–µ –∑ –ø–æ–≤–Ω–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º -->
            <input type="hidden" id="phone" name="phone" />
          </div>

          <!-- –•–∞—Ä—á—É–≤–∞–Ω–Ω—è -->
          <div class="form-group">
            <label class="form-label">
              –•–∞—Ä—á—É–≤–∞–Ω–Ω—è –≤—ñ–¥ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä—ñ–≤? <span class="req">*</span>
            </label>
            <div class="radio-group">
              <label>
                <input type="radio" name="food" value="–¢–∞–∫" required />
                <span>–¢–∞–∫</span>
              </label>
              <label>
                <input type="radio" name="food" value="–ù—ñ" />
                <span>–ù—ñ</span>
              </label>
            </div>
          </div>

          <!-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ö–∞—Ä—á—É—é—á–∏—Ö -->
          <div class="form-group" id="foodQtyField">
            <label for="food_qty" class="form-label">
              –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ö–∞—Ä—á—É—é—á–∏—Ö (1‚Äì6)
            </label>
            <input
              type="number"
              id="food_qty"
              name="food_qty"
              class="form-input"
              min="1"
              max="6"
              inputmode="numeric"
              placeholder="–í–∫–∞–∂—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å, —è–∫—â–æ –∑–∞–º–æ–≤–ª—è—î—Ç–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è"
            />
          </div>

          <!-- –ö–Ω–æ–ø–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ -->
          <div class="form-actions">
            <button type="submit" id="submitBtn" class="btn btn-primary">
              –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞—è–≤–∫—É
            </button>
            <div id="spinner" class="spinner" aria-hidden="true"></div>
          </div>

          <p class="form-note">
            ‚ö†Ô∏è –ü—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏ —É –≤–∞—Å —î <b>24 –≥–æ–¥–∏–Ω–∏</b>, —â–æ–± –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –æ–ø–ª–∞—Ç—É.
            –Ø–∫—â–æ –æ–ø–ª–∞—Ç–∞ –Ω–µ –±—É–¥–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–∞ ‚Äî –∑–∞—è–≤–∫–∞ –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–Ω—É–ª—å–æ–≤–∞–Ω–∞.
          </p>
        </form>
      </div>
    </section>
  </main>

  <!-- –ì–æ–ª–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // ==== 0. –ê–∫—Ç—É–∞–ª—å–Ω–∏–π API URL (–≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫ Apps Script) ====
    const apiUrl = 'https://script.google.com/macros/s/AKfycbzlJBi2eA8K2DpcJMcIBBbLFnX4YvDR11qy_UGKPYS2slzjHQ91jpYQBlT87fK1iVH2/exec';

    // ==== 1. –ï–ª–µ–º–µ–Ω—Ç–∏ DOM ====
    const form = document.getElementById('regForm');
    const qty = document.getElementById('food_qty');
    const qtyField = document.getElementById('foodQtyField');
    const phoneInput = document.getElementById('phone_rest');
    const phoneHidden = document.getElementById('phone');
    const copyCardBtn = document.getElementById('copyCard');
    const msg = document.getElementById('msg');
    const eventOptionsContainer = document.getElementById('eventOptions');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const fpInput = document.getElementById('fp');

    if (!form) {
      console.error('–§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó (#regForm) –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞ –≤ DOM.');
      return;
    }

    // ==== 2. Fingerprint (–±–µ–∑–ø–µ—á–Ω–∏–π, –Ω–µ –ª–∞–º–∞—î —Å—Ç–æ—Ä—ñ–Ω–∫—É) ====
    (function makeFingerprint(){
      if (!fpInput) return;
      try {
        const src = [
          navigator.userAgent,
          navigator.language,
          (screen && (screen.width + 'x' + screen.height)) || '',
          (Intl && Intl.DateTimeFormat().resolvedOptions().timeZone) || ''
        ].join('|');

        let h = 2166136261;
        for (let i = 0; i < src.length; i++) {
          h ^= src.charCodeAt(i);
          h = (h * 16777619) >>> 0;
        }
        fpInput.value = 'fp_' + h.toString(16);
      } catch (err) {
        console.warn('Fingerprint error:', err);
      }
    })();

    // ==== 3. –•–µ–ª–ø–µ—Ä –¥–ª—è —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ====
    const toggleLoading = (isLoading) => {
      if (submitBtn) {
        submitBtn.disabled = isLoading;
        submitBtn.textContent = isLoading ? '–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è...' : '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞—è–≤–∫—É';
      }
      if (spinner) {
        spinner.classList.toggle('spinner--visible', isLoading);
      }
    };

    // ==== 4. –ü—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –µ—Ç–∞–ø—ñ–≤ –∑ API ====
    const prefillEvent = () => {
      if (!eventOptionsContainer) return;
      const p = new URLSearchParams(location.search).get('event');
      if (!p) return;
      const radios = eventOptionsContainer.querySelectorAll('input[name="event"]');
      const found = Array.from(radios).find(r => (r.value || '').toLowerCase().includes(p.toLowerCase()));
      if (found) found.checked = true;
    };

    const loadEvents = async () => {
      if (!eventOptionsContainer) return;
      eventOptionsContainer.innerHTML = '<p id="loading-events">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –µ—Ç–∞–ø—ñ–≤...</p>';
      toggleLoading(true);

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (!Array.isArray(data) || data.length === 0) {
          eventOptionsContainer.innerHTML = '<p class="form-msg err">‚ùå –ù–µ–º–∞—î –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –µ—Ç–∞–ø—ñ–≤ –∞–±–æ –Ω–µ –≤–¥–∞–ª–æ—Å—è —ó—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.</p>';
          return;
        }

        let html = '';
        data.forEach(eventValue => {
          const val = String(eventValue || '').trim();
          if (!val) return;
          const icon = val.toLowerCase().includes('—Ñ—ñ–Ω–∞–ª') ? 'ü•á' : 'üèÜ';
          html += `
            <label class="event-item">
              <input type="radio" name="event" value="${val}" required>
              <span>${icon} ${val}</span>
            </label>
          `;
        });

        eventOptionsContainer.innerHTML = html || '<p class="form-msg err">‚ùå –ù–µ–º–∞—î –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –µ—Ç–∞–ø—ñ–≤ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó.</p>';
        prefillEvent();

      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –µ—Ç–∞–ø—ñ–≤:', error);
        eventOptionsContainer.innerHTML = '<p class="form-msg err">‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö. –û–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.</p>';
      } finally {
        toggleLoading(false);
      }
    };

    loadEvents();

    // ==== 5. –õ–æ–≥—ñ–∫–∞ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è ====
    const foodRadios = form.querySelectorAll('input[name="food"]');
    const toggleFood = () => {
      const need = form.food && form.food.value === '–¢–∞–∫';
      if (qty) {
        qty.disabled = !need;
        qty.required = need;
        if (!need) qty.value = '';
      }
      if (qtyField) {
        qtyField.classList.toggle('field--disabled', !need);
      }
    };

    foodRadios.forEach(r => r.addEventListener('change', toggleFood));
    toggleFood();

    // ==== 6. –¢–µ–ª–µ—Ñ–æ–Ω (–∑–±–∏—Ä–∞—î–º–æ +380XXXXXXXXX) ====
    if (phoneInput && phoneHidden) {
      phoneInput.addEventListener('input', () => {
        const clean = (phoneInput.value || '').replace(/\D/g, '').slice(0, 9);
        phoneInput.value = clean;
        phoneHidden.value = clean ? ('+380' + clean) : '';
      });
    }

    // ==== 7. –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ ====
    if (copyCardBtn) {
      copyCardBtn.addEventListener('click', async () => {
        try {
          const cardEl = document.getElementById('cardNum');
          const num = (cardEl?.textContent || '').replace(/\s+/g, '').trim() || '4874070050688793';
          await navigator.clipboard.writeText(num);
          const old = copyCardBtn.textContent;
          copyCardBtn.textContent = '‚úÖ –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ';
          setTimeout(() => copyCardBtn.textContent = old, 1500);
        } catch (err) {
          alert('–°–∫–æ–ø—ñ—é–π—Ç–µ –≤—Ä—É—á–Ω—É: 4874070050688793');
        }
      });
    }

    // ==== 8. –°–∞–±–º—ñ—Ç —Ñ–æ—Ä–º–∏ ====
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (msg) {
        msg.className = 'form-msg';
        msg.textContent = '';
      }

      // HTML5 –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
      if (!form.checkValidity()) {
        if (msg) {
          msg.className = 'form-msg err';
          msg.textContent = '–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤ º—è–∑–∫–æ–≤—ñ –ø–æ–ª—è.';
        }
        form.reportValidity?.();
        return;
      }

      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É
      if (phoneHidden && !/^\+380\d{9}$/.test(phoneHidden.value || '')) {
        if (msg) {
          msg.className = 'form-msg err';
          msg.textContent = '–ù–µ–≤—ñ—Ä–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É. –ü–æ—Ç—Ä—ñ–±–Ω–æ 9 —Ü–∏—Ñ—Ä –ø—ñ—Å–ª—è +380.';
        }
        return;
      }

      toggleLoading(true);

      try {
        const formData = new FormData(form);

        const response = await fetch(apiUrl, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (result && result.success) {
          const selectedEvent = formData.get('event') || '–æ–±—Ä–∞–Ω–∏–π –µ—Ç–∞–ø';

          if (msg) {
            msg.className = 'form-msg ok';
            msg.innerHTML = `
              ‚úÖ –ó–∞—è–≤–∫—É –Ω–∞ <b>${selectedEvent}</b> –ø—Ä–∏–π–Ω—è—Ç–æ! –û–ø–ª–∞—Ç—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞, <b>1500 ‚Ç¥</b> —Ç–∞ –≤–∫–∞–∂—ñ—Ç—å <b>–Ω–∞–∑–≤—É –∫–æ–º–∞–Ω–¥–∏</b> —É –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ –ø–ª–∞—Ç–µ–∂—É.<br><br>
              <span style="color:#f87171;font-weight:600;">
                ‚ö†Ô∏è –Ø–∫—â–æ –æ–ø–ª–∞—Ç–∞ –Ω–µ –±—É–¥–µ –∑–¥—ñ–π—Å–Ω–µ–Ω–∞ –ø—Ä–æ—Ç—è–≥–æ–º <b>24 –≥–æ–¥–∏–Ω</b> –ø—ñ—Å–ª—è –ø–æ–¥–∞–Ω–Ω—è –∑–∞—è–≤–∫–∏ ‚Äî –≤–æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ <b>–∞–Ω—É–ª—é—î—Ç—å—Å—è</b>.
              </span>
            `;
          }

          form.reset();
          if (phoneHidden) phoneHidden.value = '';
          toggleFood();

        } else {
          console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏:', result);
          if (msg) {
            msg.className = 'form-msg err';
            msg.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${result?.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –¥–∞–Ω—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.'}`;
          }
        }
      } catch (error) {
        console.error('Fetch error:', error);
        if (msg) {
          msg.className = 'form-msg err';
          msg.textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è —ñ–∑ —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.';
        }
      } finally {
        toggleLoading(false);
      }
    });
  });
  </script>
</body>
</html>
