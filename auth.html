<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>STOLAR CARP ‚Ä¢ –ê–¥–º—ñ–Ω–∫–∞</title>

  <link rel="stylesheet" href="assets/css/main.css">

  <style>
    body{ background: radial-gradient(circle at top,#111827 0,#020617 55%); }
    .admin-wrap{ max-width:1100px; margin:0 auto; padding:32px 0 70px; }
    .admin-top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 16px; border-radius:18px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.35);
      box-shadow:0 18px 40px rgba(0,0,0,.6);
    }
    .admin-badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 12px; border-radius:999px;
      font-size:.85rem; color:#e5e7eb;
      border:1px solid rgba(148,163,184,.35);
      background:rgba(0,0,0,.35);
      white-space:nowrap;
    }
    .muted{ color:#9ca3af; }
    .admin-hidden{ display:none !important; }

    .admin-card{
      margin-top:14px;
      padding:16px;
      border-radius:18px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.35);
      box-shadow:0 18px 40px rgba(0,0,0,.6);
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .row .btn{ padding:10px 14px; border-radius:12px; }

    .admin-grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media(min-width:900px){
      .admin-grid{ grid-template-columns: 1.2fr .8fr; }
    }

    .admin-list{ display:flex; flex-direction:column; gap:10px; margin-top:12px; }
    .item{
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.25);
      background:rgba(2,6,23,.55);
    }
    .item-top{ display:flex; justify-content:space-between; gap:10px; align-items:center; flex-wrap:wrap; }
    .pill{
      display:inline-flex; align-items:center;
      padding:4px 10px; border-radius:999px;
      font-size:.78rem;
      border:1px solid rgba(148,163,184,.35);
      color:#e5e7eb;
      background:rgba(0,0,0,.35);
    }
    .pill.ok{ border-color:rgba(34,197,94,.6); }
    .pill.warn{ border-color:rgba(250,204,21,.65); }
    .pill.bad{ border-color:rgba(239,68,68,.65); }

    .mini-form{
      margin-top:12px;
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    .mini-form input, .mini-form select{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,.35);
      background:rgba(2,6,23,.55);
      color:#e5e7eb;
      outline:none;
    }
    .mini-form input::placeholder{ color:#6b7280; }
  </style>
</head>

<body>

<header class="header">
  <div class="container header__row">
    <a class="logo" href="index.html">
      <span class="logo__mark">SC</span>
      <span class="logo__text">STOLAR CARP</span>
    </a>
    <nav class="nav">
      <a href="index.html" class="nav__link">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="live.html" class="nav__link">Live</a>
      <a href="rating.html" class="nav__link">–†–µ–π—Ç–∏–Ω–≥</a>
      <a href="cabinet.html" class="nav__link">–ú—ñ–π –∫–∞–±—ñ–Ω–µ—Ç</a>
    </nav>
  </div>
</header>

<main class="main">
  <section class="section container admin-wrap">

    <div class="admin-top">
      <div>
        <div class="title-gradient" style="font-size:1.2rem; font-weight:800;">–ê–¥–º—ñ–Ω–∫–∞ STOLAR CARP</div>
        <div class="muted" id="adminStatus">–ó–∞–ø—É—Å–∫‚Ä¶</div>
      </div>
      <div class="admin-badge" id="adminBadge">üîí admin</div>
    </div>

    <!-- LOGIN -->
    <div id="adminLogin" class="admin-card admin-hidden">
      <h2 class="section-title" style="margin:0 0 10px;">–í—Ö—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
      <div class="muted">–£–≤—ñ–π–¥–∏ email/–ø–∞—Ä–æ–ª–µ–º –∞–¥–º—ñ–Ω-–∞–∫–∞—É–Ω—Ç–∞. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —Ç—É—Ç –Ω–µ–º–∞—î.</div>

      <div class="row" style="margin-top:12px;">
        <input id="admEmail" type="email" placeholder="Email"
          style="flex:1; min-width:220px; padding:10px 12px; border-radius:12px; border:1px solid rgba(148,163,184,.35); background:rgba(2,6,23,.55); color:#e5e7eb;">
        <input id="admPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å"
          style="flex:1; min-width:220px; padding:10px 12px; border-radius:12px; border:1px solid rgba(148,163,184,.35); background:rgba(2,6,23,.55); color:#e5e7eb;">
        <button class="btn btn--accent" id="btnAdminLogin">–£–≤—ñ–π—Ç–∏</button>
      </div>

      <div class="muted" id="adminLoginMsg" style="margin-top:10px;"></div>
    </div>

    <!-- APP -->
    <div id="adminApp" class="admin-hidden">

      <div class="admin-card">
        <h2 class="section-title" style="margin:0 0 10px;">–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h2>
        <div class="row">
          <button class="btn btn--primary" id="btnCreateContest">1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–º–∞–≥–∞–Ω–Ω—è</button>
          <button class="btn btn--accent"  id="btnToggleContest">2. –í—ñ–¥–∫—Ä–∏—Ç–∏ / –∑–∞–∫—Ä–∏—Ç–∏</button>
          <button class="btn btn--primary" id="btnRegistrations">3. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ–º–∞–Ω–¥</button>
          <button class="btn btn--accent"  id="btnDraw">4. –ñ–µ—Ä–µ–±–∫—É–≤–∞–Ω–Ω—è</button>
          <button class="btn btn--danger"  id="btnWeigh">5. –ó–≤–∞–∂—É–≤–∞–Ω–Ω—è</button>
          <button class="btn btn--primary" id="btnUsers">6. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∞–π—Ç—É</button>
          <button class="btn btn--primary" id="btnLogout">–í–∏–π—Ç–∏</button>
        </div>
        <div class="muted" style="margin-top:10px;" id="adminHint">–û–±–µ—Ä–∏ –º–æ–¥—É–ª—å –∑–≤–µ—Ä—Ö—É.</div>
      </div>

      <div class="admin-grid">

        <!-- –õ–Ü–í–û: –ó–∞—è–≤–∫–∏ -->
        <div class="admin-card" id="modRegistrations">
          <h2 class="section-title" style="margin:0 0 10px;">–ó–∞—è–≤–∫–∏ –Ω–∞ —É—á–∞—Å—Ç—å</h2>
          <div class="muted">–ö–æ–ª–µ–∫—Ü—ñ—è: <b>registrations</b>.</div>
          <div class="row">
            <button class="btn btn--primary" id="btnLoadRegs">–û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫</button>
          </div>
          <div class="admin-list" id="regsList"></div>
        </div>

        <!-- –ü–†–ê–í–û: –ú–æ–¥—É–ª—ñ -->
        <div style="display:flex; flex-direction:column; gap:14px;">

          <div class="admin-card admin-hidden" id="modCreate">
            <h2 class="section-title" style="margin:0 0 10px;">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–º–∞–≥–∞–Ω–Ω—è (–∫–∞—Ä–∫–∞—Å)</h2>
            <div class="muted">–ó–∞–ø–∏—Å—É—î–º–æ –≤: <b>seasons</b> + <b>settings/app</b>.</div>

            <div class="mini-form">
              <input id="inpSeasonId" placeholder="seasonId (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: season-2026)" />
              <input id="inpSeasonName" placeholder="–ù–∞–∑–≤–∞ —Å–µ–∑–æ–Ω—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: STOLAR CARP 2026)" />
              <input id="inpStageId" placeholder="stageId (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: stage-1)" />
              <input id="inpStageName" placeholder="–ù–∞–∑–≤–∞ –µ—Ç–∞–ø—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –ï—Ç–∞–ø 1)" />
              <select id="inpRegOpen">
                <option value="true">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è: –í–Ü–î–ö–†–ò–¢–ê</option>
                <option value="false">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è: –ó–ê–ö–†–ò–¢–ê</option>
              </select>
            </div>

            <div class="row">
              <button class="btn btn--accent" id="btnDoCreate">–°—Ç–≤–æ—Ä–∏—Ç–∏ / –û–Ω–æ–≤–∏—Ç–∏</button>
            </div>

            <div class="muted" id="createMsg" style="margin-top:10px;"></div>
          </div>

          <div class="admin-card admin-hidden" id="modToggle">
            <h2 class="section-title" style="margin:0 0 10px;">–í—ñ–¥–∫—Ä–∏—Ç–∏ / –ó–∞–∫—Ä–∏—Ç–∏</h2>
            <div class="muted">–î–æ–∫—É–º–µ–Ω—Ç: <b>settings/app</b> –ø–æ–ª–µ <b>registrationOpen</b>.</div>
            <div class="row">
              <button class="btn btn--accent" id="btnOpenReg">–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é</button>
              <button class="btn btn--danger" id="btnCloseReg">–ó–∞–∫—Ä–∏—Ç–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é</button>
            </div>
            <div class="muted" id="toggleMsg" style="margin-top:10px;"></div>
          </div>

          <div class="admin-card admin-hidden" id="modDraw">
            <h2 class="section-title" style="margin:0 0 10px;">–ñ–µ—Ä–µ–±–∫—É–≤–∞–Ω–Ω—è</h2>
            <div class="muted">–ü—ñ–¥–∫–ª—é—á–∏–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º.</div>
          </div>

          <div class="admin-card admin-hidden" id="modWeigh">
            <h2 class="section-title" style="margin:0 0 10px;">–ó–≤–∞–∂—É–≤–∞–Ω–Ω—è</h2>
            <div class="muted">–ü—ñ–¥–∫–ª—é—á–∏–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º.</div>
          </div>

          <div class="admin-card admin-hidden" id="modUsers">
            <h2 class="section-title" style="margin:0 0 10px;">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∞–π—Ç—É</h2>
            <div class="muted">–ö–æ–ª–µ–∫—Ü—ñ—è: <b>users</b> (–æ—Å—Ç–∞–Ω–Ω—ñ 50).</div>
            <div class="row">
              <button class="btn btn--primary" id="btnLoadUsers">–û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫</button>
            </div>
            <div class="admin-list" id="usersList"></div>
          </div>

        </div>
      </div>

    </div>
  </section>
</main>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<!-- –Ñ–î–ò–ù–ò–ô —ñ–Ω—ñ—Ç -->
<script src="assets/js/firebase-init.js"></script>

<script>
  const ADMIN_UID = "5Dt6fN64c3aWACYV1WacxV2BHDl2";
  const $ = (id) => document.getElementById(id);
  const show = (el) => el && el.classList.remove("admin-hidden");
  const hide = (el) => el && el.classList.add("admin-hidden");
  const setStatus = (t) => { const e = $("adminStatus"); if(e) e.textContent = t; };

  async function waitForFirebase(){
    for(let i=0;i<80;i++){
      if(window.scAuth && window.scDb) return;
      await new Promise(r=>setTimeout(r,100));
    }
    throw new Error("Firebase –ù–ï —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π (scAuth/scDb). –ü–µ—Ä–µ–≤—ñ—Ä firebase-init.js");
  }

  function activateModule(key){
    const mods = {
      regs: $("modRegistrations"),
      create: $("modCreate"),
      toggle: $("modToggle"),
      draw: $("modDraw"),
      weigh: $("modWeigh"),
      users: $("modUsers")
    };
    Object.values(mods).forEach(hide);
    if(key && mods[key]) show(mods[key]);
  }

  async function init(){
    await waitForFirebase();
    const auth = window.scAuth;
    const db   = window.scDb;

    const loginBox = $("adminLogin");
    const appBox   = $("adminApp");
    const msg      = $("adminLoginMsg");

    const btnLogin = $("btnAdminLogin");
    const btnLogout= $("btnLogout");

    const showLogin = (text) => { hide(appBox); show(loginBox); if(msg) msg.textContent = text || ""; };
    const showApp   = () => { hide(loginBox); show(appBox); };

    if(btnLogin){
      btnLogin.onclick = async () => {
        const email = ($("admEmail")?.value || "").trim();
        const pass  = ($("admPass")?.value || "").trim();
        if(!email || !pass){ msg.textContent = "–í–≤–µ–¥–∏ email —ñ –ø–∞—Ä–æ–ª—å"; return; }
        msg.textContent = "–í—Ö—ñ–¥‚Ä¶";
        try{
          await auth.signInWithEmailAndPassword(email, pass);
        }catch(e){
          msg.textContent = "–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É: " + (e?.message || "");
        }
      };
    }

    if(btnLogout){
      btnLogout.onclick = async () => {
        await auth.signOut();
      };
    }

    // –º–µ–Ω—é
    $("btnRegistrations")?.addEventListener("click",()=>activateModule("regs"));
    $("btnCreateContest")?.addEventListener("click",()=>activateModule("create"));
    $("btnToggleContest")?.addEventListener("click",()=>activateModule("toggle"));
    $("btnDraw")?.addEventListener("click",()=>activateModule("draw"));
    $("btnWeigh")?.addEventListener("click",()=>activateModule("weigh"));
    $("btnUsers")?.addEventListener("click",()=>activateModule("users"));
    activateModule("regs");

    // –ø—Ä–æ—Å—Ç–∏–π –ª–æ–∞–¥–µ—Ä –∑–∞—è–≤–æ–∫
    $("btnLoadRegs")?.addEventListener("click", async ()=>{
      const wrap = $("regsList");
      if(!wrap) return;
      wrap.innerHTML = `<div class="muted">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>`;
      try{
        const snap = await db.collection("registrations").orderBy("createdAt","desc").limit(50).get();
        if(snap.empty){ wrap.innerHTML = `<div class="muted">–ü–æ—Ä–æ–∂–Ω—å–æ</div>`; return; }
        wrap.innerHTML = snap.docs.map(d=>{
          const x = d.data() || {};
          return `
            <div class="item">
              <div class="item-top">
                <div><b>${(x.teamName||x.team||"–ö–æ–º–∞–Ω–¥–∞")}</b></div>
                <span class="pill ${x.paid ? "ok":"warn"}">${x.paid ? "–û–ø–ª–∞—á–µ–Ω–æ":"–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ"}</span>
              </div>
              <div class="muted" style="margin-top:6px;">
                UID: ${x.uid || "-"} ¬∑ –¢–µ–ª: ${x.captainPhone || x.phone || "-"}
              </div>
            </div>`;
        }).join("");
      }catch(e){
        wrap.innerHTML = `<div class="muted">–ü–æ–º–∏–ª–∫–∞: ${e.message}</div>`;
      }
    });

    // –ø—Ä–æ—Å—Ç–∏–π –ª–æ–∞–¥–µ—Ä —é–∑–µ—Ä—ñ–≤
    $("btnLoadUsers")?.addEventListener("click", async ()=>{
      const wrap = $("usersList");
      if(!wrap) return;
      wrap.innerHTML = `<div class="muted">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>`;
      try{
        const snap = await db.collection("users").orderBy("createdAt","desc").limit(50).get();
        if(snap.empty){ wrap.innerHTML = `<div class="muted">–ü–æ—Ä–æ–∂–Ω—å–æ</div>`; return; }
        wrap.innerHTML = snap.docs.map(d=>{
          const x = d.data() || {};
          return `
            <div class="item">
              <div class="item-top">
                <div><b>${(x.fullName||x.name||"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á")}</b></div>
                <span class="pill">${x.role || "member"}</span>
              </div>
              <div class="muted" style="margin-top:6px;">
                ${x.email || "-"} ¬∑ ${x.phone || "-"}
              </div>
            </div>`;
        }).join("");
      }catch(e){
        wrap.innerHTML = `<div class="muted">–ü–æ–º–∏–ª–∫–∞: ${e.message}</div>`;
      }
    });

    // –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Å—ñ—ó
    auth.onAuthStateChanged(user=>{
      if(!user){
        setStatus("–ü–æ—Ç—Ä—ñ–±–µ–Ω –≤—Ö—ñ–¥");
        showLogin("–£–≤—ñ–π–¥–∏ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä");
        return;
      }
      if(user.uid !== ADMIN_UID){
        setStatus("–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ");
        showLogin("–¶–µ–π –∞–∫–∞—É–Ω—Ç –Ω–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É (–Ω–µ –∞–¥–º—ñ–Ω UID)");
        return;
      }
      setStatus("–ê–¥–º—ñ–Ω-–¥–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª–µ–Ω–æ");
      showApp();
    });
  }

  init().catch(err=>{
    console.error(err);
    setStatus("–ü–æ–º–∏–ª–∫–∞: " + err.message);
    show($("adminLogin"));
  });
</script>

</body>
</html>
